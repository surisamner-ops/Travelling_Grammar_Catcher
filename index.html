<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úàÔ∏è Travel Grammar Catcher</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6C5CE7;
            --primary-light: #A29BFE;
            --secondary: #00CEC9;
            --accent: #FD79A8;
            --dark: #2D3436;
            --light: #F7F9FC;
            --success: #00B894;
            --error: #FF7675;
            --glass: rgba(255, 255, 255, 0.95);
            --shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.25);
            --radius: 24px;
            --radius-lg: 32px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
        }

        body {
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 30%, #f093fb 70%, #f5576c 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            overflow-x: hidden;
            touch-action: none;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* Floating background elements */
        .bg-element {
            position: fixed;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 20s infinite ease-in-out;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-30px) rotate(5deg); }
        }

        /* Header */
        #header {
            text-align: center;
            padding: 10px 25px;
            margin-bottom: 10px;
            z-index: 20;
            width: 100%;
            max-width: 900px;
        }

        #header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            letter-spacing: -0.5px;
        }

        /* Stats Bar */
        #stats-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 10px;
            z-index: 20;
            width: 100%;
            max-width: 900px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            border-radius: var(--radius);
            padding: 10px 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--dark);
            box-shadow: var(--shadow);
            border: 2px solid rgba(255,255,255,0.6);
            transition: var(--transition);
        }

        .stat-card.score { border-left: 5px solid var(--secondary); }
        .stat-card.lives { border-left: 5px solid var(--accent); }

        .stat-icon { font-size: 1.5rem; }
        .stat-value { font-size: 1.4rem; color: var(--primary); min-width: 30px; text-align: center; }

        /* Progress Bar */
        #progress-container {
            width: 100%;
            max-width: 900px;
            margin-bottom: 10px;
            z-index: 20;
            padding: 0 10px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            color: white;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 5px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .progress-bar {
            height: 12px;
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.4);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            border-radius: 10px;
            width: 0%;
            transition: width 0.3s ease-out;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Game Container */
        #game-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            height: 550px;
            background: linear-gradient(180deg, #87CEEB 0%, #B3E0F7 50%, #E8F5E9 80%, #4CAF50 100%);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            z-index: 10;
            border: 4px solid rgba(255,255,255,0.6);
            cursor: crosshair;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* Clouds */
        .cloud {
            position: absolute;
            background: rgba(255,255,255,0.8);
            border-radius: 50px;
            animation: drift linear infinite;
            pointer-events: none;
            z-index: 1;
            filter: blur(1px);
        }
        .cloud::before, .cloud::after {
            content: '';
            position: absolute;
            background: inherit;
            border-radius: 50%;
        }
        @keyframes drift {
            from { transform: translateX(-200px); }
            to { transform: translateX(calc(100% + 200px)); }
        }

        /* Basket Glow */
        .basket-glow {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(108,92,231,0.5) 0%, transparent 70%);
            pointer-events: none;
            z-index: 5;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: opacity 0.2s;
        }
        .basket-glow.active { opacity: 1; }

        /* Modals */
        .modal {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(45, 52, 54, 0.85);
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: white;
            display: none;
            padding: 20px;
        }

        .modal-content {
            background: var(--glass);
            color: var(--dark);
            padding: 30px;
            border-radius: var(--radius-lg);
            text-align: center;
            max-width: 550px;
            width: 95%;
            animation: modalPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: var(--shadow-lg);
            border: 3px solid var(--primary-light);
            position: relative;
            overflow: hidden;
        }

        @keyframes modalPop {
            from { transform: scale(0.8) translateY(20px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }

        .modal h2 {
            margin: 0 0 15px 0;
            color: var(--primary);
            font-size: 1.8rem;
            font-weight: 800;
            position: relative;
            z-index: 2;
        }

        .quiz-question {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--dark);
            margin: 20px 0 25px;
            padding: 15px;
            background: rgba(108,92,231,0.1);
            border-radius: 16px;
            border-left: 5px solid var(--primary);
            position: relative;
            z-index: 2;
            line-height: 1.4;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: relative;
            z-index: 2;
        }

        .btn {
            background: linear-gradient(135deg, var(--secondary), #00d1b2);
            border: none;
            padding: 14px 20px;
            font-size: 1.1rem;
            font-weight: 700;
            font-family: inherit;
            color: white;
            cursor: pointer;
            border-radius: 14px;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(0, 206, 201, 0.4);
            position: relative;
            overflow: hidden;
        }

        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 206, 201, 0.6); }
        .btn:active { transform: translateY(1px); }
        .btn:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }

        .btn.correct { background: linear-gradient(135deg, var(--success), #00a388); }
        .btn.incorrect { background: linear-gradient(135deg, var(--error), #e15554); }

        .btn-restart {
            background: linear-gradient(135deg, var(--primary), #5a4fcf);
            margin-top: 20px;
            padding: 16px 35px;
            font-size: 1.2rem;
            box-shadow: 0 6px 20px rgba(108, 92, 231, 0.5);
            width: 100%;
        }

        #quiz-feedback {
            height: 24px;
            font-weight: 700;
            font-size: 1.1rem;
            margin-top: 12px;
            position: relative;
            z-index: 2;
        }

        /* Controls Hint - MOVED BELOW GAME */
        #controls-hint {
            margin-top: 15px;
            font-size: 1rem;
            color: var(--dark);
            background: rgba(255,255,255,0.9);
            padding: 10px 25px;
            border-radius: 50px;
            border: 2px solid rgba(108,92,231,0.3);
            z-index: 15;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow);
            font-weight: 600;
            pointer-events: none;
            animation: hintPulse 3s ease-in-out infinite;
        }

        @keyframes hintPulse {
            0%, 100% { box-shadow: var(--shadow); }
            50% { box-shadow: 0 15px 50px rgba(108,92,231,0.4); }
        }

        /* Catch Animation */
        .catch-effect {
            position: absolute;
            font-size: 2rem;
            font-weight: 800;
            color: #FFD700;
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
            pointer-events: none;
            animation: catchPop 0.6s ease-out forwards;
            z-index: 20;
        }

        @keyframes catchPop {
            0% { transform: scale(0.5) translateY(0); opacity: 1; }
            50% { transform: scale(1.2) translateY(-20px); opacity: 1; }
            100% { transform: scale(0.8) translateY(-40px); opacity: 0; }
        }

        /* Responsive */
        @media (max-width: 600px) {
            #header h1 { font-size: 1.5rem; }
            .stat-card { padding: 8px 15px; font-size: 1rem; }
            #game-container { height: 450px; }
            .modal-content { padding: 20px; }
            .quiz-question { font-size: 1.1rem; }
        }
    </style>
</head>
<body>

    <!-- Background Elements -->
    <div class="bg-element" style="width: 80px; height: 80px; top: 10%; left: 5%;"></div>
    <div class="bg-element" style="width: 120px; height: 120px; top: 60%; right: 8%; animation-delay: -5s;"></div>
    <div class="bg-element" style="width: 60px; height: 60px; bottom: 15%; left: 15%; animation-delay: -10s;"></div>

    <div id="header">
        <h1><span>‚úàÔ∏è</span> Travel Grammar Catcher <span>üß≥</span></h1>
    </div>

    <div id="stats-bar">
        <div class="stat-card score">
            <span class="stat-icon">‚≠ê</span>
            <span>Score:</span>
            <span class="stat-value" id="score">0</span>
        </div>
        <div class="stat-card lives">
            <span class="stat-icon">‚ù§Ô∏è</span>
            <span>Lives:</span>
            <span class="stat-value" id="lives">10</span>
        </div>
    </div>

    <div id="progress-container">
        <div class="progress-label">
            <span>Next Quiz: <span id="next-quiz-at">5</span> pts</span>
            <span id="progress-text">0/5</span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
    </div>

    <div id="game-container">
        <canvas id="gameCanvas" width="900" height="550"></canvas>
        <div class="basket-glow" id="basket-glow"></div>
        
        <div id="quiz-modal" class="modal">
            <div class="modal-content">
                <h2>üéì Grammar Challenge!</h2>
                <p class="quiz-question" id="quiz-question">Question...</p>
                <div class="quiz-options" id="quiz-options"></div>
                <p id="quiz-feedback"></p>
            </div>
        </div>

        <div id="game-over-modal" class="modal">
            <div class="modal-content">
                <h2 id="end-title">üéâ Amazing!</h2>
                <p id="end-message">You're a grammar master!</p>
                <p style="font-size: 1.3rem; margin: 20px 0; color: var(--primary);">
                    Final Score: <strong id="final-score" style="font-size: 1.8rem;">0</strong> ‚≠ê
                </p>
                <button class="btn btn-restart" onclick="resetGame()">üîÑ Play Again</button>
            </div>
        </div>
    </div>
    
    <!-- Controls Hint MOVED HERE (Below Game) -->
    <div id="controls-hint">üéÆ <strong>Mouse</strong> or <strong>Touch</strong> to move basket</div>

    <script>
        // --- CONFIGURATION ---
        const customBasketUrl = "https://raw.githubusercontent.com/surisamner-ops/Games_Images/refs/heads/main/3d-illustration-travel-suitcase-with-tropical-island-travel-beach-vacation-concept-isolated-on-transparent-background-generative-ai-free-png.webp";
        
        const customFallingUrls = [
            "https://raw.githubusercontent.com/surisamner-ops/Games_Images/refs/heads/main/219-2195036_swimsuit-bikini-clip-art-bikini-vector-png.png",
            "https://raw.githubusercontent.com/surisamner-ops/Games_Images/refs/heads/main/clothing-clip-art-19.png",
            "https://raw.githubusercontent.com/surisamner-ops/Games_Images/refs/heads/main/flip-flops-clipart-design-illustration-free-png.webp",
            "https://raw.githubusercontent.com/surisamner-ops/Games_Images/refs/heads/main/pngtree-blue-diving-mask-clipart-illustration-png-image_17065762.png",
            "https://raw.githubusercontent.com/surisamner-ops/Games_Images/refs/heads/main/pngtree-illustrated-typography-t-shirt-design-png-image_11984881.png"
        ];
        
        const defaultEmojis = ["‚úàÔ∏è", "üß≥", "üó∫Ô∏è", "üöÇ", "üöó", "üöå", "üèñÔ∏è", "üèîÔ∏è", "üéí", "üö§", "üõ≥Ô∏è"];
        
        const quizData = [
            { q: "I ______ (sleep) when the phone rang.", options: ["slept", "was sleeping", "had slept"], correct: 1 },
            { q: "She ______ (leave) before I arrived.", options: ["left", "was leaving", "had left"], correct: 2 },
            { q: "They ______ (watch) TV all evening yesterday.", options: ["watched", "were watching", "had watched"], correct: 1 },
            { q: "He ______ (break) his leg while skiing.", options: ["broke", "was breaking", "had broken"], correct: 0 },
            { q: "By the time we arrived, the train ______ (go).", options: ["went", "was going", "had gone"], correct: 2 },
            { q: "What ______ (you/do) at 8 PM last night?", options: ["did you do", "were you doing", "had you done"], correct: 1 },
            { q: "I ______ (never/see) such beauty before.", options: ["never saw", "was never seeing", "had never seen"], correct: 2 },
            { q: "While I ______ (cook), I cut my finger.", options: ["cooked", "was cooking", "had cooked"], correct: 1 },
            { q: "She ______ (finish) homework before dinner.", options: ["finished", "was finishing", "had finished"], correct: 2 },
            { q: "It ______ (rain) when we left.", options: ["rained", "was raining", "had rained"], correct: 1 },
            { q: "We ______ (know) each other for years before marrying.", options: ["knew", "were knowing", "had known"], correct: 2 },
            { q: "He ______ (read) when lights went out.", options: ["read", "was reading", "had read"], correct: 1 },
            { q: "After they ______ (eat), they walked.", options: ["ate", "were eating", "had eaten"], correct: 2 },
            { q: "I ______ (lose) my keys yesterday.", options: ["lost", "was losing", "had lost"], correct: 0 },
            { q: "The sun ______ (shine) all day.", options: ["shone", "was shining", "had shone"], correct: 1 },
            { q: "When I arrived, the meeting ______ (start).", options: ["started", "was starting", "had started"], correct: 2 },
            { q: "She ______ (study) English in London.", options: ["studied", "was studying", "had studied"], correct: 0 },
            { q: "I ______ (wait) an hour before he came.", options: ["waited", "was waiting", "had waited"], correct: 2 },
            { q: "While mom ______ (drive), dad read the map.", options: ["drove", "was driving", "had driven"], correct: 1 },
            { q: "They ______ (not/see) the movie before.", options: ["didn't see", "weren't seeing", "hadn't seen"], correct: 2 }
        ];

        // --- GAME STATE ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let score = 0;
        let lives = 10;  // CHANGED FROM 3 TO 10
        let gameActive = true;
        let isPaused = false;
        let lastQuizScore = 0;
        let quizThreshold = 5;
        
        let fallingItems = [];
        let currentFallingObjects = [];
        let particles = [];
        let catchEffects = [];
        
        // Basket Configuration
        const basket = {
            x: 340,
            y: 420,
            width: 220,
            height: 160,
            img: null,
            emoji: "üß≥",
            glow: document.getElementById('basket-glow')
        };

        const keys = { ArrowLeft: false, ArrowRight: false };
        let mouseX = null;

        // --- ASSET LOADING ---
        function loadImage(url) {
            return new Promise((resolve) => {
                const img = new Image();
                img.crossOrigin = "anonymous";
                img.onload = () => resolve({ success: true, img });
                img.onerror = () => resolve({ success: false });
                img.src = url.trim();
            });
        }

        async function initImages() {
            const basketResult = await loadImage(customBasketUrl);
            if (basketResult.success) {
                basket.img = basketResult.img;
            }
            
            for (const url of customFallingUrls) {
                const result = await loadImage(url);
                if (result.success) {
                    fallingItems.push({ type: 'image', val: result.img, loaded: true });
                }
            }
            if (fallingItems.length === 0) {
                fallingItems = defaultEmojis.map(e => ({ type: 'emoji', val: e }));
            }
        }

        // --- GAME LOOP ---
        async function startGame() {
            createClouds();
            await initImages();
            updateProgress();
            requestAnimationFrame(gameLoop);
        }

        function createClouds() {
            const container = document.getElementById('game-container');
            for (let i = 0; i < 4; i++) {
                const cloud = document.createElement('div');
                cloud.className = 'cloud';
                const size = 60 + Math.random() * 40;
                cloud.style.width = `${size * 2}px`;
                cloud.style.height = `${size}px`;
                cloud.style.top = `${10 + Math.random() * 25}%`;
                cloud.style.animationDuration = `${30 + Math.random() * 20}s`;
                cloud.style.animationDelay = `${-Math.random() * 30}s`;
                cloud.style.boxShadow = `${-size/2}px 0 ${size/3}px rgba(255,255,255,0.9), ${size/2}px 0 ${size/3}px rgba(255,255,255,0.9)`;
                container.appendChild(cloud);
            }
        }

        function spawnObject() {
            if (!gameActive || isPaused || fallingItems.length === 0) return;
            
            const data = fallingItems[Math.floor(Math.random() * fallingItems.length)];
            const size = 75; 
            const x = Math.random() * (canvas.width - size);
            
            currentFallingObjects.push({
                x, y: -size, size,
                speed: 2.5 + score * 0.05,
                data,
                rotation: Math.random() * 360,
                rotationSpeed: (Math.random() - 0.5) * 1.5
            });
        }
        setInterval(spawnObject, 1400);

        function update() {
            if (!gameActive || isPaused) return;

            if (keys.ArrowLeft) basket.x = Math.max(0, basket.x - 15);
            if (keys.ArrowRight) basket.x = Math.min(canvas.width - basket.width, basket.x + 15);

            if (mouseX !== null) {
                basket.x = mouseX - basket.width / 2;
                if (basket.x < 0) basket.x = 0;
                if (basket.x > canvas.width - basket.width) basket.x = canvas.width - basket.width;
            }

            basket.glow.style.left = `${basket.x + basket.width/2}px`;
            basket.glow.style.top = `${basket.y + basket.height/2}px`;
            basket.glow.style.width = '180px';
            basket.glow.style.height = '180px';

            for (let i = currentFallingObjects.length - 1; i >= 0; i--) {
                const obj = currentFallingObjects[i];
                obj.y += obj.speed;
                obj.rotation += obj.rotationSpeed;

                if (obj.x < basket.x + basket.width - 10 &&
                    obj.x + obj.size > basket.x + 10 &&
                    obj.y < basket.y + basket.height - 10 &&
                    obj.y + obj.size > basket.y + 10) {
                    
                    score++;
                    updateUI();
                    updateProgress();
                    showCatchEffect(obj.x + obj.size/2, obj.y);
                    checkWinCondition();
                    checkQuizTrigger();
                    currentFallingObjects.splice(i, 1);
                    continue;
                }

                if (obj.y > canvas.height) {
                    lives--;
                    updateUI();
                    currentFallingObjects.splice(i, 1);
                    if (lives <= 0) endGame();
                }
            }

            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx; p.y += p.vy; p.vy += 0.1;
                p.life--; p.size *= 0.96;
                if (p.life <= 0 || p.size < 0.3) particles.splice(i, 1);
            }

            for (let i = catchEffects.length - 1; i >= 0; i--) {
                catchEffects[i].life--;
                if (catchEffects[i].life <= 0) {
                    catchEffects[i].element.remove();
                    catchEffects.splice(i, 1);
                }
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (basket.img?.complete) {
                ctx.drawImage(basket.img, basket.x, basket.y, basket.width, basket.height);
            } else {
                ctx.font = "80px Arial";
                ctx.textAlign = "left";
                ctx.textBaseline = "top";
                ctx.fillText(basket.emoji, basket.x + 10, basket.y + 10);
            }

            currentFallingObjects.forEach(obj => {
                ctx.save();
                ctx.translate(obj.x + obj.size/2, obj.y + obj.size/2);
                ctx.rotate(obj.rotation * Math.PI / 180);
                
                if (obj.data.type === 'emoji') {
                    ctx.font = "60px Arial";
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    ctx.fillText(obj.data.val, 0, 0);
                } else if (obj.data.loaded && obj.data.val.complete) {
                    ctx.drawImage(obj.data.val, -obj.size/2, -obj.size/2, obj.size, obj.size);
                } else {
                    ctx.fillStyle = "#6C5CE7";
                    ctx.beginPath();
                    ctx.arc(0, 0, obj.size/2, 0, Math.PI * 2);
                    ctx.fill();
                }
                ctx.restore();
            });

            particles.forEach(p => {
                ctx.globalAlpha = p.life / 100;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;
            });
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // --- UI FUNCTIONS ---
        function updateUI() {
            document.getElementById('score').textContent = score;
            // Display hearts or number for lives
            document.getElementById('lives').textContent = lives;
        }

        function updateProgress() {
            const progress = ((score % quizThreshold) / quizThreshold) * 100;
            document.getElementById('progress-fill').style.width = `${progress}%`;
            document.getElementById('progress-text').textContent = `${score % quizThreshold}/${quizThreshold}`;
            document.getElementById('next-quiz-at').textContent = quizThreshold;
        }

        function showCatchEffect(x, y) {
            const effect = document.createElement('div');
            effect.className = 'catch-effect';
            effect.textContent = '+1 ‚≠ê';
            effect.style.left = `${x}px`;
            effect.style.top = `${y}px`;
            document.getElementById('game-container').appendChild(effect);
            catchEffects.push({ element: effect, life: 40 });
            
            basket.glow.classList.add('active');
            setTimeout(() => basket.glow.classList.remove('active'), 200);
        }

        function checkQuizTrigger() {
            if (score >= quizThreshold && score % 5 === 0 && score > lastQuizScore) {
                lastQuizScore = score;
                quizThreshold += 5;
                triggerQuiz();
            }
        }

        function checkWinCondition() {
            if (score >= 50) {
                startFireworks();
                setTimeout(() => endGame(true), 3500);
            }
        }

        // --- QUIZ SYSTEM ---
        function triggerQuiz() {
            isPaused = true;
            basket.glow.classList.add('active');
            
            const modal = document.getElementById('quiz-modal');
            const qText = document.getElementById('quiz-question');
            const qOptions = document.getElementById('quiz-options');
            const feedback = document.getElementById('quiz-feedback');
            
            const q = quizData[Math.floor(Math.random() * quizData.length)];
            qText.textContent = q.q;
            qOptions.innerHTML = '';
            feedback.textContent = '';
            feedback.style.color = '';

            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.textContent = opt;
                btn.onclick = () => handleAnswer(btn, idx, q.correct, feedback, modal);
                qOptions.appendChild(btn);
            });

            modal.style.display = 'flex';
        }

        function handleAnswer(btn, selected, correct, feedback, modal) {
            document.querySelectorAll('.quiz-options .btn').forEach(b => b.disabled = true);
            
            if (selected === correct) {
                btn.classList.add('correct');
                feedback.textContent = '‚úì Perfect! Keep going! üéâ';
                feedback.style.color = '#00B894';
                setTimeout(() => {
                    modal.style.display = 'none';
                    isPaused = false;
                    basket.glow.classList.remove('active');
                }, 1000);
            } else {
                btn.classList.add('incorrect');
                document.querySelectorAll('.quiz-options .btn')[correct].classList.add('correct');
                feedback.textContent = '‚úó Not quite! -5 points';
                feedback.style.color = '#FF7675';
                score = Math.max(0, score - 5);
                updateUI();
                updateProgress();
                setTimeout(() => {
                    modal.style.display = 'none';
                    isPaused = false;
                    basket.glow.classList.remove('active');
                }, 1500);
            }
        }

        // --- FIREWORKS ---
        function startFireworks() {
            for (let i = 0; i < 150; i++) {
                particles.push({
                    x: canvas.width/2 + (Math.random()-0.5)*350,
                    y: canvas.height/2 + (Math.random()-0.5)*180,
                    vx: (Math.random()-0.5)*18,
                    vy: (Math.random()-0.5)*18,
                    life: 90 + Math.random()*40,
                    color: `hsl(${Math.random()*360}, 100%, 60%)`,
                    size: 4 + Math.random()*5
                });
            }
        }

        // --- GAME CONTROL ---
        function endGame(win = false) {
            gameActive = false;
            const modal = document.getElementById('game-over-modal');
            const title = document.getElementById('end-title');
            const msg = document.getElementById('end-message');
            
            modal.style.display = 'flex';
            document.getElementById('final-score').textContent = score;
            
            if (win) {
                title.textContent = 'üèÜ Champion!';
                title.style.color = '#FFD700';
                msg.textContent = 'You caught 50 items and mastered Past Tenses!';
            } else {
                title.textContent = 'üéÆ Game Over';
                title.style.color = 'var(--accent)';
                msg.textContent = 'Keep practicing! You\'ll get it next time! üí™';
            }
        }

        function resetGame() {
            score = 0; 
            lives = 10;  // CHANGED FROM 3 TO 10
            lastQuizScore = 0; 
            quizThreshold = 5;
            currentFallingObjects = []; 
            particles = []; 
            catchEffects = [];
            gameActive = true; 
            isPaused = false;
            basket.x = 340; 
            mouseX = null;
            
            updateUI(); 
            updateProgress();
            document.getElementById('game-over-modal').style.display = 'none';
            document.getElementById('quiz-modal').style.display = 'none';
            basket.glow.classList.remove('active');
        }

        // --- EVENT LISTENERS ---
        window.addEventListener('keydown', e => {
            if (keys.hasOwnProperty(e.code)) keys[e.code] = true;
        });
        window.addEventListener('keyup', e => {
            if (keys.hasOwnProperty(e.code)) keys[e.code] = false;
        });

        canvas.addEventListener('mousemove', e => {
            if (!gameActive || isPaused) return;
            const rect = canvas.getBoundingClientRect();
            mouseX = (e.clientX - rect.left) * (canvas.width / rect.width);
        });
        
        canvas.addEventListener('mouseleave', () => { mouseX = null; });

        canvas.addEventListener('touchmove', e => {
            if (!gameActive || isPaused) return;
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            mouseX = (e.touches[0].clientX - rect.left) * (canvas.width / rect.width);
        }, { passive: false });
        
        canvas.addEventListener('touchend', () => { mouseX = null; });
        canvas.addEventListener('contextmenu', e => e.preventDefault());

        startGame();
    </script>
</body>
</html>